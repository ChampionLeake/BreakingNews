/*
Copyright 2019 Amir Leake

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

.arm
.global _start
.section .init

#define PAYLOAD_ADR 0x020b9e84
#define EMPTY_SLOT_CRC32 0x21591197

_start:
	.ascii "rPcB"	@ PARA-Header
	.ascii "BreakingNews"	@ Slot-1 Profile name; The player name has a limit of 15 character strings to create the save-slot. The string length/size is not checked so using a long extensive string, one can overwrite several stack registers and take control of the Point Counter(0x1A7 bytes) and using it to jump to your unsigned code from the stack.
	.fill 0x10, 1, 0x20
	.word PAYLOAD_ADR	@ The payload address will jump to the offset of 0x1900 to execute unsigned code.
	.fill 0xFC, 1, 0x20
	.org 0x63C
	.word 0	@ CRC32
	
misc_data:
	@ Profile Data Slot-2
	.ascii "rErP"
	.fill 0x638, 1, 0xFF
	.word EMPTY_SLOT_CRC32
	
	
	@ Profile Data Slot-3
	.ascii "rErP"
	.fill 0x638, 1, 0xFF
	.word EMPTY_SLOT_CRC32
	
	
	@ Profile Data Slot-4
	.ascii "rErP"
	.fill 0x638, 1, 0xFF
	.word EMPTY_SLOT_CRC32
	
	
payload:
	.incbin "./payload/payload.bin"		@ Unsigned code injected here :)
	.fill 0xB0, 1, 0xFF
